# 브라우저와 자바스크립트

상태: 진행 중
날짜: June 9, 2025

# 자바스크립트의 실행 컨텍스트

### 실행 컨텍스트란?

- 정의
    - 실행 컨텍스트는 실행 가능한 코드에 제공할 환경 정보를 모아놓은 객체
    - 해당 객체에는 변수 객체, 스코프 체인, this 정보가 담겨있다

- 구성요소
    
    ```jsx
    // 실행 컨텍스트 구조 (개념적)
    ExecutionContext = {
        LexicalEnvironment: { /* 변수, 함수 선언 */ },
        VariableEnvironment: { /* var 선언 */ },
        ThisBinding: { /* this 값 */ }
    }
    ```
    

```jsx
JavaScript 런타임 환경
├── JavaScript 엔진
│   ├── 호출 스택 (Call Stack)
│   │   ├── 전역 실행 컨텍스트
│   │   ├── 함수 실행 컨텍스트 1
│   │   └── 함수 실행 컨텍스트 2
│   │       ├── LexicalEnvironment
│   │       ├── VariableEnvironment
│   │       └── ThisBinding
│   └── 힙 (Heap)
│       ├── 객체들
│       ├── 배열들
│       └── 함수들
└── 런타임 환경 (브라우저/Node.js)
    ├── 이벤트 루프
    ├── 태스크 큐 (Macrotask Queue)
    ├── 마이크로태스크 큐 (Microtask Queue)
    └── Web APIs / Node.js APIs
```

- 전역 컨텍스트는 단일한 환경으로 브라우저 상에서는 HTML 문서가 로드되고 JavaScript 코드 실행이 시작될 때 생성된다.
    - 페이지가 언로드(새로고침, 닫기 등) 될때까지 유지된다.
    - React는 브라우저의 전역 컨텍스트 내에서 동작한다.
- 실행 컨텍스트는 함수가 실행될 때 생성된다.
    - 즉, 함수가 실행되는 순간 생성되는 일종의 격리된 환경이라고 생각하면 이해가 쉽다.
    - 따라서 컨텍스트는 javascript 엔진에 의해서 생성되며, 관리된다.
    - 컨텍스트는 Call Stack으로 관리되고 있다.
- 비동기 작업에서 `별도의 컨텍스트가 생성됐다`는 말의 의미는 무엇인가?
    
    ```jsx
    A() => {
        B()
    }
    ```
    
    - A가 종료되기 전 B가 실행됨
    - callStack에 A→B가 쌓임
    
    ```jsx
    A() => {
        setTimeout(B, 0)  
    }
    ```
    
    - A 실행 → B를 별도의 task로 등록 → A 종료 → B 실행 시작
    - A와 B는 별도의 작업으로 관리됨

### Task Queue, Macrotask/Microtask Queue

- 해야할 일에 대한 리스트업 개념
    - Call Stack이 비어있을때 실행됨
- 작동 우선순위
    - Call Stack
        - 현재 실행 중인 동기 코드
        - 즉시 처리 실행
    - Microtask Queue
        - Call Stack이 비면 즉시 처리된다.
        - 이벤트 루프의 한 주기에 여러번 처리됨
    - Macrotask Queue
        - Microtask가 모두 비면 처리된다.
- 정의는 누가 하고 있는가?
    - 자바스크립트에는 ‘Job’, ‘JobQueue’의 추상적인 개념만 존재함.(**ECMAScript**)
    - 브라우저/node (즉, 호스트)단에서 구현하여 처리하고 있음
    - 비동기 관련 이벤트들(ex.Promise)는 javascript 언어 명세의 일부지만, 실제적인 task 관리는 호스트에서 처리하고 있음.
        
        → 따라서 어떤 브라우저냐에 따라서 처리 순서가 달라질 수 있음.
        
        [참고](https://tc39.es/ecma262/#sec-jobs)
        
        > [Jobs](https://tc39.es/ecma262/#job) are scheduled for execution by ECMAScript [host environments](https://tc39.es/ecma262/#host-environment) in a particular [agent](https://tc39.es/ecma262/#agent).
        > 
        
        > 9.5.5 HostEnqueuePromiseJob ( job, realm )
        > 
        > 
        > The [host-defined](https://tc39.es/ecma262/#host-defined) abstract operation HostEnqueuePromiseJob takes arguments job (a [Job](https://tc39.es/ecma262/#job) [Abstract Closure](https://tc39.es/ecma262/#sec-abstract-closure)) and realm (a [Realm Record](https://tc39.es/ecma262/#realm-record) or null) and returns unused. It schedules job to be performed at some future time. The [Abstract Closures](https://tc39.es/ecma262/#sec-abstract-closure) used with this algorithm are intended to be related to the handling of Promises, or otherwise, to be scheduled with equal priority to Promise handling operations.
        > 

### 이벤트루프

https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/platform/scheduler/public/event_loop.h;l=1;drc=ab5261de6f730d1378a27c400f8640440f662303;bpv=1;bpt=1

### agent

https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/execution_context/window_agent.cc;l=15

---

- 브라우저에서 setTimeout이 만드는 컨텍스트는 함수의 실행 컨텍스트?
    - 그렇다면 브라우저/리액트에서 전역 컨텍스트는 언제 생성되고 얼마나 유지되는가?
    - 리액트의 비동기처리는 어느 범위의 컨텍스트에 기록되어 있는가?
        - 리액트의 fiber은 브라우저-자바스크립트 실행 과정 중 어디에 관여하고 있는가?
            - 자바스크립트로 작성된 코드가 있나?
- `Promise` 는 자바스크립트의 기능이다.
    - 그런데 내부 콜백 실행 주체는 외부에 있다?
    - 브라우저에서 어떻게 처리하는가?
    - 처리하는 엔진이 다르게 동작한다면 Promise 처리 방식도 달라질 수 있는가?
- 렌더링 엔진과 node.js
    - 자바스크립트 엔진은 V8 → 기본적인 이해 필요
    - 외부 엔진과 내부 엔진이 어떤 방식으로 태스크 순서에 대해 주고 받는가?
    - 자바스크립트 엔진은 어떻게 외부(web api등)에 요청을 보내고 있는가?
    - 렌더링 엔진 별로 작동 방식이 모두 동일한가? 다른 지점도 발생하지 않나?
- 

---

https://helloworldjavascript.net/pages/285-async.html

https://eyabc.github.io/Doc/dev/core-javascript/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%9D%98%20JS%20%EC%8B%A4%ED%96%89%EA%B3%BC%EC%A0%95.html#%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%9D%98-javascript-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EA%B3%BC%EC%A0%95

https://velog.io/@yoondengo/%EC%9B%B9-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%97%90%EC%84%9C-%EB%B3%B4%EB%8A%94-JavaScript-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EA%B3%BC%EC%A0%95

https://javascript.info/event-loop

https://javannspring.tistory.com/233

https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Execution_model

https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/

https://www.freecodecamp.org/news/how-javascript-works-behind-the-scene-javascript-execution-context/

https://velog.io/@alsgud8311/React-Fiber-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EB%94%A5%EB%8B%A4%EC%9D%B4%EB%B8%8C

https://stackoverflow.com/questions/9384758/what-is-the-execution-context-in-javascript-exactly

https://geistjs.com/blog/javascript-execution-context

https://velog.io/@onedanbee/%EB%B9%84%EB%8F%99%EA%B8%B0-Task-Queue-Macrotask-Queue-%EC%99%80-Microtask-Queue-%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C

https://tc39.es/ecma262/#sec-hostenqueuepromisejob

https://velog.io/@thms200/Event-Loop-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84